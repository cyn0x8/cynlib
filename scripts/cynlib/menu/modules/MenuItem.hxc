import flixel.FlxBasic;

import funkin.modding.module.ScriptedModule;

typedef MenuItem = {
	data:Null<Dynamic>,
	
	menu:Null<Dynamic>,
	container:Null<FlxBasic>,
	
	autoNavigate:Bool,
	
	enabled:Bool,
	focused:Bool,
	
	onFocus:Null<(Dynamic)->Void>,
	onUnfocus:Null<(Dynamic)->Void>,
	onDirection:Null<(Array<Bool>)->Void>,
	
	onPress:Null<()->Void>,
	onRelease:Null<()->Void>,
	
	onUpdate:Null<(Float)->Void>,
	
	exists:Bool,
	destroy:()->Void
}

typedef MenuItemData = {
	data:Null<Dynamic>,
	
	menu:Null<Dynamic>,
	container:Null<FlxBasic>,
	
	autoNavigate:Null<Bool>,
	
	onFocus:Null<(Dynamic)->Void>,
	onUnfocus:Null<(Dynamic)->Void>,
	onDirection:Null<(Array<Bool>)->Void>,
	
	onPress:Null<()->Void>,
	onRelease:Null<()->Void>,
	
	onUpdate:Null<(Float)->Void>
}

class CL_MenuItem extends ScriptedModule {
	public function new() {
		super("CL_MenuItem", -2147483648);
	}
	
	override public function onCreate(event:ScriptEvent):Void {
		active = false;
	}
	
	public function new_MenuItem(data:MenuItemData):Menu {
		if (data == null) {
			data = {};
		}
		
		var obj:Dynamic = {
			data: data.data == null ? {} : data.data,
			
			menu: data.menu,
			container: data.container,
			
			autoNavigate: data.autoNavigate == null ? true : data.autoNavigate,
			
			enabled: false,
			focused: false,
			
			onFocus: data.onFocus == null ? function(prev:Null<Dynamic>):Void {} : data.onFocus,
			onUnfocus: data.onUnfocus == null ? function(next:Dynamic):Void {} : data.onUnfocus,
			onDirection: data.onDirection == null ? function(directions:Array<Bool>):Void {} : data.onDirection,
				
			onPress: data.onPress == null ? function():Void {} : data.onPress,
			onRelease: data.onRelease == null ? function():Void {} : data.onRelease,
				
			onUpdate: data.onUpdate == null ? function(elapsed:Float):Void {} : data.onUpdate,
				
			exists: true
		};
		
		obj.destroy = function():Void {
			obj.data = null;
	
			obj.parent = null;
			obj.container = null;
			
			obj.autoNavigate = false;
			
			obj.enabled = false;
			obj.focused = false;
			
			obj.onFocus = null;
			obj.onUnfocus = null;
			obj.onDirection = null;
			
			obj.onPress = null;
			obj.onRelease = null;
			
			obj.onUpdate = null;
			
			obj.exists = false;
		};
		
		return obj;
	}
}